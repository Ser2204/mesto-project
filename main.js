(()=>{"use strict";var e=document.querySelector(".profile"),t=(e.querySelector(".profile__info"),e.querySelector(".profile__button-edit")),n=e.querySelector(".profile__avatar-layout"),o=e.querySelector(".profile__button-add"),r=(document.querySelector("#closeEdit"),document.querySelector("#editProfile")),c=document.querySelector("#formEdit"),u=c.querySelector("#heading"),i=c.querySelector("#subheading"),l=e.querySelector(".profile__title"),a=e.querySelector(".profile__subtitle"),s=document.querySelector("#addCard"),d=(document.querySelector(".element__delete-button"),document.querySelector("#closeAddCard"),document.querySelector("#newCard")),f=d.querySelector("#nameImage"),m=d.querySelector("#linkImage"),_=document.querySelector("#submitChangeAvatar"),v=document.querySelector("#submitAddCard"),y=document.querySelector("#submitEditProfile"),h=document.querySelector("#changeAvatar"),p=(document.querySelector("#closeChangeAvatar"),document.querySelector("#formChangeAvatar")),S=document.querySelector("#avatarLinkInput"),b=document.querySelector(".profile__foto"),q=document.querySelector(".elements"),k=document.querySelector("#element").content,C=document.querySelector(".popup_type_look-closer"),g=C.querySelector(".popup__look-closer-image"),E=C.querySelector(".popup__look-closer-name");function L(e){e.classList.add("popup_opened"),document.addEventListener("keydown",x),e.addEventListener("click",U)}function A(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",x),e.removeEventListener("click",U)}function x(e){"Escape"===e.key&&A(document.querySelector(".popup_opened"))}function U(e){e.target.classList.contains("popup__overlay")&&A(e.currentTarget)}function P(e){e.setAttribute("disabled",""),e.classList.add("form__submit_disabled")}C.querySelector(".popup__close_look-closer"),C.querySelector("#popup__close_look-closer"),Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){A(e)}))}));var T=function(e,t){w(e)?P(t):function(e){e.removeAttribute("disabled"),e.classList.remove("form__submit_disabled")}(t)},w=function(e){return e.some((function(e){return!e.validity.valid}))};function D(e,t,n,o){var r=k.cloneNode(!0),c=r.querySelector(".element__image"),u=r.querySelector(".element__like-counter"),i=r.querySelector(".element__delete-button"),l=r.querySelector(".element__like-button");r.querySelector(".element__title").textContent=e.name,c.setAttribute("src",e.link),c.setAttribute("alt",e.name),u.textContent=e.likes.length,q.prepend(r),c.addEventListener("click",(function(){g.setAttribute("src",e.link),g.setAttribute("alt",e.name),E.textContent=e.name,L(C)})),e.owner._id===t?i.addEventListener("click",n):i.remove(),O(e.likes,t)&&l.classList.add("element__like-button_active"),l.addEventListener("click",o)}function O(e,t){return void 0!==e.find((function(e){return e._id===t}))}function I(e,t,n){var o=e.querySelector(".element__like-button");e.querySelector(".element__like-counter").textContent=t.length,O(t,n)?o.classList.add("element__like-button_active"):o.classList.remove("element__like-button_active")}var N={baseUrl:"https://nomoreparties.co/v1/plus-cohort-16",headers:{authorization:"703c9790-16d9-4dc9-84fc-515962733489","Content-Type":"application/json"}};function j(e){if(e.ok)return e.json();Promise.reject("Ошибка: ".concat(e.status))}var J,M,B,H,V,z,F="",G=[];function K(e){b.style.backgroundImage="url(".concat(e,")")}function Q(e,t){l.textContent=e,a.textContent=t}function R(e){return function(t){var n=t.target.closest(".element");(function(e){return fetch(N.baseUrl+"/cards/".concat(e),{method:"DELETE",headers:N.headers}).then((function(e){return j(e)}))})(e).then((function(){n.closest(".element").remove()})).catch((function(e){console.log(e)}))}}function W(e){return function(t){var n,o=t.target.closest(".element");!function(e){return e.querySelector(".element__like-button").classList.contains("element__like-button_active")}(o)?function(e){return fetch(N.baseUrl+"/cards/likes/".concat(e),{method:"PUT",headers:N.headers}).then((function(e){return j(e)}))}(e._id).then((function(e){console.log(e),I(o,e.likes,F)})).catch((function(e){console.log(e)})):(n=e._id,fetch(N.baseUrl+"/cards/likes/".concat(n),{method:"DELETE",headers:N.headers}).then((function(e){return j(e)}))).then((function(e){console.log(e),I(o,e.likes,F)})).catch((function(e){console.log(e)}))}}M=(J={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"}).formSelector,B=J.inputSelector,H=J.submitButtonSelector,V=J.inputErrorClass,z=J.errorClass,Array.from(document.querySelectorAll(M)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,o,r){var c=Array.from(e.querySelectorAll(t)),u=e.querySelector(n);T(c,u),c.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.getAttribute("data_error_message")):t.setCustomValidity(""),t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)}(e,t,o,r),T(c,u)}))}))}(e,B,H,V,z)})),n.addEventListener("click",(function(){p.reset(),P(_),L(h)})),p.addEventListener("submit",(function(){var e,t=_.textContent;_.textContent="Сохранение...",(e=S.value,fetch(N.baseUrl+"/users/me/avatar",{method:"PATCH",headers:N.headers,body:JSON.stringify({avatar:e})}).then((function(e){return j(e)}))).then((function(){A(h),K(S.value)})).catch((function(e){console.log(e)})).finally((function(){_.textContent=t}))})),t.addEventListener("click",(function(){var e={name:l.textContent,about:a.textContent};u.value=e.name,i.value=e.about,L(r),P(y)})),c.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=y.textContent;y.textContent="Сохранение...",(t=u.value,n=i.value,fetch(N.baseUrl+"/users/me",{method:"PATCH",headers:N.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return j(e)}))).then((function(){Q(u.value,i.value),A(r)})).catch((function(e){console.log(e)})).finally((function(){y.textContent=o}))})),o.addEventListener("click",(function(){d.reset(),P(v),L(s)})),d.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=v.textContent;v.textContent="Сохранение...",(t=f.value,n=m.value,fetch(N.baseUrl+"/cards",{method:"POST",headers:N.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return j(e)}))).then((function(e){D(e,F,R(e._id),W(e)),A(s)})).catch((function(e){console.log(e)})).finally((function(){v.textContent=o}))})),window.addEventListener("DOMContentLoaded",(function(){Promise.all([fetch(N.baseUrl+"/users/me",{method:"get",headers:N.headers}).then((function(e){return j(e)})),fetch(N.baseUrl+"/cards",{headers:N.headers}).then((function(e){return j(e)}))]).then((function(e){var t=e[0];F=t._id,Q(t.name,t.about),K(t.avatar);var n=e[1];!function(e){e.reverse().forEach((function(e){D(e,F,R(e._id),W(e))}))}(n),n.forEach((function(e){G.push(e)}))})).catch((function(e){console.log(e)}))}))})();