(()=>{"use strict";var e=document.querySelector(".profile"),t=(e.querySelector(".profile__info"),e.querySelector(".profile__button-edit")),n=e.querySelector(".profile__avatar-layout"),o=e.querySelector(".profile__button-add"),r=(document.querySelector("#closeEdit"),document.querySelector("#editProfile")),c=document.querySelector("#formEdit"),u=c.querySelector("#heading"),i=c.querySelector("#subheading"),l=e.querySelector(".profile__title"),a=e.querySelector(".profile__subtitle"),s=document.querySelector("#addCard"),d=(document.querySelector(".element__delete-button"),document.querySelector("#closeAddCard"),document.querySelector("#newCard")),f=d.querySelector("#nameImage"),m=d.querySelector("#linkImage"),_=document.querySelector("#submitChangeAvatar"),v=document.querySelector("#submitAddCard"),y=document.querySelector("#submitEditProfile"),h=document.querySelector("#changeAvatar"),p=(document.querySelector("#closeChangeAvatar"),document.querySelector("#formChangeAvatar")),S=document.querySelector("#avatarLinkInput"),b=document.querySelector(".profile__foto"),q=document.querySelector(".elements"),k=document.querySelector("#element").content,g=document.querySelector(".popup_type_look-closer"),C=g.querySelector(".popup__look-closer-image"),E=g.querySelector(".popup__look-closer-name");function L(e){e.textContent,e.textContent="Сохранение..."}function A(e){e.textContent,e.textContent="Сохранение"}function x(e){e.classList.add("popup_opened"),document.addEventListener("keydown",P),e.addEventListener("click",T)}function U(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",P),e.removeEventListener("click",T)}function P(e){"Escape"===e.key&&U(document.querySelector(".popup_opened"))}function T(e){e.target.classList.contains("popup__overlay")&&U(e.currentTarget)}g.querySelector(".popup__close_look-closer"),g.querySelector("#popup__close_look-closer"),Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){U(e)}))}));var w={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active",inactiveButtonClass:"form__submit_disabled"},D=function(e,t,n){B(e)?O(t,n):function(e,t){e.removeAttribute("disabled"),e.classList.remove(t.inactiveButtonClass)}(t,n)},B=function(e){return e.some((function(e){return!e.validity.valid}))};function O(e,t){e.setAttribute("disabled",""),e.classList.add(t.inactiveButtonClass)}function I(e,t,n,o){var r=k.cloneNode(!0),c=r.querySelector(".element__image"),u=r.querySelector(".element__like-counter"),i=r.querySelector(".element__delete-button"),l=r.querySelector(".element__like-button");r.querySelector(".element__title").textContent=e.name,c.setAttribute("src",e.link),c.setAttribute("alt",e.name),u.textContent=e.likes.length,q.prepend(r),c.addEventListener("click",(function(){C.setAttribute("src",e.link),C.setAttribute("alt",e.name),E.textContent=e.name,x(g)})),e.owner._id===t?i.addEventListener("click",n):i.remove(),N(e.likes,t)&&l.classList.add("element__like-button_active"),l.addEventListener("click",o)}function N(e,t){return void 0!==e.find((function(e){return e._id===t}))}function V(e,t,n){var o=e.querySelector(".element__like-button");e.querySelector(".element__like-counter").textContent=t.length,N(t,n)?o.classList.add("element__like-button_active"):o.classList.remove("element__like-button_active")}var j={baseUrl:"https://nomoreparties.co/v1/plus-cohort-16",headers:{authorization:"703c9790-16d9-4dc9-84fc-515962733489","Content-Type":"application/json"}};function J(e){if(e.ok)return e.json();Promise.reject("Ошибка: ".concat(e.status))}var M="";function H(e){b.style.backgroundImage="url(".concat(e,")")}function z(e,t){l.textContent=e,a.textContent=t}function F(e){return function(t){var n=t.target.closest(".element");(function(e){return fetch(j.baseUrl+"/cards/".concat(e),{method:"DELETE",headers:j.headers}).then((function(e){return J(e)}))})(e).then((function(){n.closest(".element").remove()})).catch((function(e){console.log(e)}))}}function G(e){return function(t){var n,o=t.target.closest(".element");!function(e){return e.querySelector(".element__like-button").classList.contains("element__like-button_active")}(o)?function(e){return fetch(j.baseUrl+"/cards/likes/".concat(e),{method:"PUT",headers:j.headers}).then((function(e){return J(e)}))}(e._id).then((function(e){console.log(e),V(o,e.likes,M)})).catch((function(e){console.log(e)})):(n=e._id,fetch(j.baseUrl+"/cards/likes/".concat(n),{method:"DELETE",headers:j.headers}).then((function(e){return J(e)}))).then((function(e){console.log(e),V(o,e.likes,M)})).catch((function(e){console.log(e)}))}}!function(e){var t=e.configValidate;Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);D(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.getAttribute("data_error_message")):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),D(n,o,t)}))}))}(e,t)}))}({configValidate:w}),n.addEventListener("click",(function(){p.reset(),O(_,w),x(h)})),p.addEventListener("submit",(function(){var e;L(_),(e=S.value,fetch(j.baseUrl+"/users/me/avatar",{method:"PATCH",headers:j.headers,body:JSON.stringify({avatar:e})}).then((function(e){return J(e)}))).then((function(){U(h),H(S.value)})).catch((function(e){console.log(e)})).finally((function(){A(_)}))})),t.addEventListener("click",(function(){var e={name:l.textContent,about:a.textContent};u.value=e.name,i.value=e.about,x(r),O(y,w)})),c.addEventListener("submit",(function(e){var t,n;e.preventDefault(),L(y),(t=u.value,n=i.value,fetch(j.baseUrl+"/users/me",{method:"PATCH",headers:j.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return J(e)}))).then((function(){z(u.value,i.value),U(r)})).catch((function(e){console.log(e)})).finally((function(){A(y)}))})),o.addEventListener("click",(function(){d.reset(),x(s),O(v,w)})),d.addEventListener("submit",(function(e){var t,n;e.preventDefault(),L(v),(t=f.value,n=m.value,fetch(j.baseUrl+"/cards",{method:"POST",headers:j.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return J(e)}))).then((function(e){I(e,M,F(e._id),G(e)),U(s)})).catch((function(e){console.log(e)})).finally((function(){A(v)}))})),window.addEventListener("DOMContentLoaded",(function(){Promise.all([fetch(j.baseUrl+"/users/me",{method:"get",headers:j.headers}).then((function(e){return J(e)})),fetch(j.baseUrl+"/cards",{headers:j.headers}).then((function(e){return J(e)}))]).then((function(e){var t=e[0];M=t._id,z(t.name,t.about),H(t.avatar),e[1].reverse().forEach((function(e){I(e,M,F(e._id),G(e))}))})).catch((function(e){console.log(e)}))}))})();