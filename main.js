(()=>{"use strict";var e=document.querySelector(".profile"),t=(e.querySelector(".profile__info"),e.querySelector(".profile__button-edit")),n=e.querySelector(".profile__avatar-layout"),o=e.querySelector(".profile__button-add"),r=(document.querySelector("#closeEdit"),document.querySelector("#editProfile")),c=document.querySelector("#formEdit"),u=c.querySelector("#heading"),i=c.querySelector("#subheading"),a=e.querySelector(".profile__title"),l=e.querySelector(".profile__subtitle"),s=document.querySelector("#addCard"),d=(document.querySelector(".element__delete-button"),document.querySelector("#closeAddCard"),document.querySelector("#newCard")),f=d.querySelector("#nameImage"),m=d.querySelector("#linkImage"),v=document.querySelector("#submitChangeAvatar"),_=document.querySelector("#submitAddCard"),y=document.querySelector("#submitEditProfile"),h=document.querySelector("#changeAvatar"),p=(document.querySelector("#closeChangeAvatar"),document.querySelector("#formChangeAvatar")),S=document.querySelector("#avatarLinkInput"),b=document.querySelector(".profile__foto"),q=document.querySelector(".elements"),C=document.querySelector("#element").content,k=document.querySelector(".popup_type_look-closer"),g=k.querySelector(".popup__look-closer-image"),E=k.querySelector(".popup__look-closer-name");function L(e){e.classList.add("popup_opened"),document.addEventListener("keydown",x),e.addEventListener("click",U)}function A(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",x),e.removeEventListener("click",U)}function x(e){"Escape"===e.key&&A(document.querySelector(".popup_opened"))}function U(e){e.target.classList.contains("popup__overlay")&&A(e.currentTarget)}k.querySelector(".popup__close_look-closer"),k.querySelector("#popup__close_look-closer"),Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){A(e)}))}));var P={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active",inactiveButtonClass:"form__submit_disabled"},T=function(e,t,n){w(e)?(t.setAttribute("disabled",""),t.classList.add(n.inactiveButtonClass)):(t.removeAttribute("disabled"),t.classList.remove(n.inactiveButtonClass))},w=function(e){return e.some((function(e){return!e.validity.valid}))};function B(e,t){e.setAttribute("disabled",""),e.classList.add(t.inactiveButtonClass)}function D(e,t,n,o){var r=C.cloneNode(!0),c=r.querySelector(".element__image"),u=r.querySelector(".element__like-counter"),i=r.querySelector(".element__delete-button"),a=r.querySelector(".element__like-button");r.querySelector(".element__title").textContent=e.name,c.setAttribute("src",e.link),c.setAttribute("alt",e.name),u.textContent=e.likes.length,q.prepend(r),c.addEventListener("click",(function(){g.setAttribute("src",e.link),g.setAttribute("alt",e.name),E.textContent=e.name,L(k)})),e.owner._id===t?i.addEventListener("click",n):i.remove(),O(e.likes,t)&&a.classList.add("element__like-button_active"),a.addEventListener("click",o)}function O(e,t){return void 0!==e.find((function(e){return e._id===t}))}function I(e,t,n){var o=e.querySelector(".element__like-button");e.querySelector(".element__like-counter").textContent=t.length,O(t,n)?o.classList.add("element__like-button_active"):o.classList.remove("element__like-button_active")}var N={baseUrl:"https://nomoreparties.co/v1/plus-cohort-16",headers:{authorization:"703c9790-16d9-4dc9-84fc-515962733489","Content-Type":"application/json"}};function V(e){if(e.ok)return e.json();Promise.reject("Ошибка: ".concat(e.status))}var j="",J=[];function M(e){b.style.backgroundImage="url(".concat(e,")")}function H(e,t){a.textContent=e,l.textContent=t}function z(e){return function(t){var n=t.target.closest(".element");(function(e){return fetch(N.baseUrl+"/cards/".concat(e),{method:"DELETE",headers:N.headers}).then((function(e){return V(e)}))})(e).then((function(){n.closest(".element").remove()})).catch((function(e){console.log(e)}))}}function F(e){return function(t){var n,o=t.target.closest(".element");!function(e){return e.querySelector(".element__like-button").classList.contains("element__like-button_active")}(o)?function(e){return fetch(N.baseUrl+"/cards/likes/".concat(e),{method:"PUT",headers:N.headers}).then((function(e){return V(e)}))}(e._id).then((function(e){console.log(e),I(o,e.likes,j)})).catch((function(e){console.log(e)})):(n=e._id,fetch(N.baseUrl+"/cards/likes/".concat(n),{method:"DELETE",headers:N.headers}).then((function(e){return V(e)}))).then((function(e){console.log(e),I(o,e.likes,j)})).catch((function(e){console.log(e)}))}}!function(e){var t=e.configValidate;Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);T(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.getAttribute("data_error_message")):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),T(n,o,t)}))}))}(e,t)}))}({configValidate:P}),n.addEventListener("click",(function(){p.reset(),B(v),L(h)})),p.addEventListener("submit",(function(){var e,t=v.textContent;v.textContent="Сохранение...",(e=S.value,fetch(N.baseUrl+"/users/me/avatar",{method:"PATCH",headers:N.headers,body:JSON.stringify({avatar:e})}).then((function(e){return V(e)}))).then((function(){A(h),M(S.value)})).catch((function(e){console.log(e)})).finally((function(){v.textContent=t}))})),t.addEventListener("click",(function(){var e={name:a.textContent,about:l.textContent};u.value=e.name,i.value=e.about,L(r),B(y,P)})),c.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=y.textContent;y.textContent="Сохранение...",(t=u.value,n=i.value,fetch(N.baseUrl+"/users/me",{method:"PATCH",headers:N.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return V(e)}))).then((function(){H(u.value,i.value),A(r)})).catch((function(e){console.log(e)})).finally((function(){y.textContent=o}))})),o.addEventListener("click",(function(){d.reset(),L(s),B(_,P)})),d.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=_.textContent;_.textContent="Сохранение...",(t=f.value,n=m.value,fetch(N.baseUrl+"/cards",{method:"POST",headers:N.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return V(e)}))).then((function(e){D(e,j,z(e._id),F(e)),A(s)})).catch((function(e){console.log(e)})).finally((function(){_.textContent=o}))})),window.addEventListener("DOMContentLoaded",(function(){Promise.all([fetch(N.baseUrl+"/users/me",{method:"get",headers:N.headers}).then((function(e){return V(e)})),fetch(N.baseUrl+"/cards",{headers:N.headers}).then((function(e){return V(e)}))]).then((function(e){var t=e[0];j=t._id,H(t.name,t.about),M(t.avatar);var n=e[1];!function(e){e.reverse().forEach((function(e){D(e,j,z(e._id),F(e))}))}(n),n.forEach((function(e){J.push(e)}))})).catch((function(e){console.log(e)}))}))})();